version: '3.4'

volumes:
  postgresql_data:
    name: postgresql_data

services:

   reverse-proxy:     
      image: mozdag.azurecr.io/reverseproxy:latest
      ports:
        - "80:80"
        - "443:443"

   db:
     image: postgres
     restart: always
     environment:
       POSTGRES_PASSWORD: example
       PGDATA: /var/lib/postgresql/data/pgdata
     volumes:
       - postgresql_data:/var/lib/postgresql/data/pgdata
     ports:
       - "5432:5432"

   itstiloop:
     image: mozdag.azurecr.io/itstiloop
     environment:
       DB_CONNECTION: PostgresComposeConnection
       SAMPLE_FSP_1: bankbethesda|BETHESDAAPIID|BETHESDAAPIKEY|0x4FB12e252800A12A3c58D9F3Fb3eD13F6d1A6092
       SAMPLE_FSP_1_PARTIES: 5551234567|5551234568
       SAMPLE_FSP_2: bankwheaton|WHEATONAPIID|WHEATONAPIKEY|0x82e1f895C18aCF34E39763306b616bf6170257ea
       SAMPLE_FSP_2_PARTIES: 5551234569|5551234566
     ports:
       - "8081:80"
     depends_on:
       - db

   bankbethesda:
     image: mozdag.azurecr.io/itstiloopsamplefsp
     environment:
       FSP_NAME: BANKBETHESDA
       PARTICIPANT_ID: 1
       ITSTILOOP_URI: http://itstiloop/
       ITSTILOOP_API_ID: BETHESDAAPIID
       ITSTILOOP_API_KEY: BETHESDAAPIKEY
       ACCOUNTS: Mert:Ozdag:5551234567:10000|Ava:Jeay:5551234568:20000
     ports:
       - "8083:80"
     depends_on:
       - itstiloop

   bankwheaton:
     image: mozdag.azurecr.io/itstiloopsamplefsp
     environment:
       FSP_NAME: BANKWHEATON
       PARTICIPANT_ID: 2
       ITSTILOOP_URI: http://itstiloop/
       ITSTILOOP_API_ID: WHEATONAPIID
       ITSTILOOP_API_KEY: WHEATONAPIKEY
       ACCOUNTS: Clemence:Jeay:5551234569:10000|Ella:Jeay:5551234566:20000
     ports:
       - "8084:80"
     depends_on:
       - itstiloop     